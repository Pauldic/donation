{% extends "core/includes/base_back.html" %}
{% load i18n static mathfilters humanize %}

{% block content_body %}
    <style>
        .panel{
            border: 1px solid #e47d0d !important;
            box-shadow: 0 1px 1px rgb(191, 139, 82) !important;;
        }
    </style>
    <!-- //header-ends -->
    <div id="page-wrapper" style="min-height: 407px;">
        <div class="main-page">
            <div style="margin-top: 70px;" class="four-grids">
                <div class="col-md-4 four-grid">
                    <div class="four-grid1">
                        <div class="icon"><i class="glyphicon glyphicon-briefcase" aria-hidden="true"></i></div>
                        <div class="four-text">
                            <h3>Put Help (PH)</h3>
                            <h4>{{ total_ph_amount|floatformat:2|intcomma }}  <sup>Total</sup></h4>
                            <h4>{{ ph_bal|floatformat:2|intcomma }}  <sup>Pending</sup></h4>
                            <p> <span class="inlinebar"><canvas width="29" height="18" style="display: inline-block; width: 29px; height: 18px; vertical-align: top;"></canvas></span> </p>
                        </div>
                        <a href="#" id="ph-btn" >Put Help (PH)</a>
                    </div>
                </div>
{#                <div class="col-md-4 four-grid">#}
{#                    <div class="four-grid2">#}
{#                        <div class="icon">#}
{#                            <i class="glyphicon glyphicon-gift" aria-hidden="true"></i>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
                <div class="col-md-4 four-grid">
                    <div class="four-grid3">
                        <div class="icon">
                            <i class="glyphicon glyphicon-gift" aria-hidden="true"></i>
                        </div>
                        <div class="four-text">
                            <h3>Take Help (TH)</h3>
                            <h4>{{ total_gh_amount|floatformat:2|intcomma }}  <sup>Queued</sup></h4>
                            <h4>{{ total_paid|floatformat:2|intcomma }}  <sup>Cashed</sup></h4>
                            <p><span class="dynamicbar"><canvas width="34" height="18" style="display: inline-block; width: 34px; height: 18px; vertical-align: top;"></canvas></span></p>
                        </div>
                        <a href="javascript:;" >Taking Help (TH)</a>
                    </div>
                </div>
                <div class="col-md-4 four-grid">
                    <div class="four-grid4">
                        <div class="icon">
                            <i class="glyphicon glyphicon-shopping-cart" aria-hidden="true"></i>
                        </div>
                        <div class="four-text">
                            <h3>Bonus Box</h3>
                            <h4>{{ total_bonus_amount|floatformat:2|intcomma }}  <sup>Bouns</sup></h4>
                            <h4>{{ request.user.member.released_balance|floatformat:2|intcomma }}  <sup>RC Bal</sup></h4>
                            <p> <span class="inlinebar"><canvas width="29" height="18" style="display: inline-block; width: 29px; height: 18px; vertical-align: top;"></canvas></span> </p>
                        </div>
                        <a href="javascript:;" >Take Bouns</a>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="play-grid">
{#            <script src="{% static 'back/js/amcharts.js' %}" type="text/javascript"></script>#}
{#            <script src="{% static 'back/js/serial.js' %}" type="text/javascript"></script>#}
{#            <script src="{% static 'back/js/amstock.js' %}" type="text/javascript"></script>#}


                {% for ph in pending_phs %}
                    {% if pending_phs|length == 1 %}
                        <div class="col-xs-12">
                    {% else %}
                        <div class="col-md-6 col-xs-12">
                    {% endif %}

                {% if ph.status == 'Awaiting Payment' %}
                    <div class="panel panel-white post panel-shadow">
                        <div class="post-heading">
{#                            <div class="pull-left image"><i class="fa fa-envelope text-warning"></i></div>#}
                            <div class="meta">
                                <div class="title h5">
                                    <a href="javascript:;"><b>{{ request.user.member.first_name }}</b> please Put
                                          ‎₦ {{ ph.amount|intcomma }} in <i>{{ ph.transaction.owner.first_name }}</i> Box</a>
                                </div>
{#                                <h6 class="text-muted time">Since {{ ph.created|naturaltime }} </h6>#}
                            </div>
                        </div>
                        <div class="post-description">
                            <div class="time-to-pay text-center" data-expires="{{ ph.expires }}" data-type="PH-WP" data-transaction-detail="{{ ph.id }}"></div>
                            <p>ID: {{ ph.id }}</p>
                            <div class="row no-margin">
                                <a href="javascript:;" class="btn btn-warning stat-item refuse-to-pay" data-type="PH-WP-No" data-transaction-detail="{{ ph.id }}" style="margin-bottom: 5px">
                                    I will Not Pay
                                </a>
                                <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="PH-WP-Yes" data-transaction-detail="{{ ph.id }}">
                                    I will Pay
                                </a>
{#                                <small><i>Total: ‎₦ {{ ph.transaction.amount|intcomma }} Bal.: ‎₦ {{ ph.transaction.balance|intcomma }}</i></small>#}
                            </div>
                        </div>
                    </div>
                {% elif ph.status == 'Awaiting Confirmation' %}
                    <div class="panel panel-white post panel-shadow">
                        <div class="post-heading">
                            <div class="meta">
                                <div class="title h5">
                                    <a href="javascript:;">
                                        {{ request.user.member.first_name }}, we have informed <i>{{ ph.transaction.owner.first_name }}</i> about payment ‎₦ {{ ph.amount|intcomma }}
                                    </a>
                                </div>
{#                                <h6 class="text-muted time">Since {{ ph.proof_date|naturaltime }} </h6>#}
                            </div>
                        </div>
                        <div class="post-description">
                            <div class="time-to-pay text-center" data-expires="{{ ph.proof_date }}" data-type="PH-WC" data-transaction-detail="{{ ph.id }}"></div>
                            <p>ID: {{ ph.id }}</p>
                            <div class="row no-margin">
                                {#                        <a href="javascript:;" class="btn btn-warning stat-item refuse-to-pay" data-type="PH-WC-Yes" data-transaction-detail="{{ ph.id }}" style="margin-bottom: 5px">#}
                                {#                            <i class="fa fa-thumbs-down icon white"></i> I Decline to Pay this Participant#}
                                {#                        </a>#}
                                <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="PH-WC-Yes" data-transaction-detail="{{ ph.id }}">
                                   Show Details
                                </a>
{#                                <small><i>Total: ‎₦ {{ ph.transaction.amount|intcomma }} Bal.: ‎₦ {{ ph.transaction.balance|intcomma }}</i></small>#}
                            </div>
                        </div>
                    </div>
                {% elif ph.status == 'Exception' %}
                    <div class="panel panel-white post panel-shadow">
                        <div class="post-heading">
                            <div class="meta">
                                <div class="title h5">
                                    <a href="javascript:;">Disagreement, please PM Admin with => {{ ph.id }}
                                        ‎₦ {{ ph.amount|intcomma }}</a>
                                </div>
                            </div>
                        </div>
                        <div class="post-description">
                            <div class="time-to-pay_ text-center text-danger" data-expires="{{ ph.expires }}" data-type="PH-EX" data-transaction-detail="{{ ph.id }}">Get your Prove ready
                            </div>
                            <p>ID: {{ ph.id }}</p>
                            <div class="row no-margin">
                                <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="PH-EX-Yes" data-transaction-detail="{{ ph.id }}" data-tdid="{{ ph.id }}">
                                    Show Details
                                </a>
{#                                <small><i>Total: ‎₦ {{ ph.transaction.amount|intcomma }} Bal.: ‎₦ {{ ph.transaction.balance|intcomma }}</i></small>#}
                            </div>
                        </div>
                    </div>
                {% elif ph.status == 'Cancelled' %}
                    <div class="panel panel-white post panel-shadow">
                        <div class="post-heading">
                            <div class="meta">
                                <div class="title h5">
                                    <a href="javascript:;"><b>{{ request.user.member.first_name }}</b> this transaction ‎₦ {{ ph.amount|intcomma }} has been
                                        cancelled</a>
                                </div>
                            </div>
                        </div>
                        <div class="post-description">
                            <div class="time-to-pay_ text-center" data-expires="{{ ph.expires }}" data-type="PH-CX" data-transaction-detail="{{ ph.id }}">Cancelled Transaction</div>
                            <p>ID: {{ ph.id }}</p>
                            <div class="row no-margin">
                                <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="PH-CX-Yes" data-transaction-detail="{{ ph.id }}" data-tdid="{{ ph.id }}">
                                     Show Details
                                </a>
{#                                <small><i>Total: ‎₦ {{ ph.transaction.amount|intcomma }} Bal.: ‎₦ {{ ph.transaction.balance|intcomma }}</i></small>#}
                            </div>
                        </div>
                    </div>
                {% elif ph.status == 'Confirmed' %}
                    <div class="panel panel-white post panel-shadow">
                        <div class="post-heading">
                            <div class="meta">
                                <div class="title h5">
                                    <a href="javascript:;"><b>{{ request.user.member.first_name }}</b> this transaction ‎(₦ {{ ph.amount|intcomma }}) has been completed</a>
                                </div>
{#                                <h6 class="text-muted time">Since {{ ph.proof_acknowledge_date|naturaltime }} </h6>#}
                            </div>
                        </div>
                        <div class="post-description">
                            <div class="time-to-pay text-center" data-expires="{{ ph.expires }}" data-type="PH-CO" data-transaction-detail="{{ ph.id }}">Completed Transaction</div>
                            <p>Order: {{ ph.id }}</p>
                            <div class="row no-margin">
                                <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="PH-CO-Yes" data-transaction-detail="{{ ph.id }}" data-tdid="{{ ph.id }}">
                                    Show Details
                                </a>
{#                                <small><i>Total: ‎₦ {{ ph.transaction.amount|intcomma }} Bal.: ‎₦ {{ ph.transaction.balance|intcomma }}</i></small>#}
                            </div>
                        </div>
                    </div>
                {% endif %}
                </div>
                {% endfor %}


                {% for gh in pending_ghs %}
                    {% if pending_ghs|length == 1 %}
                        <div class="col-xs-12">
                    {% else %}
                        <div class="col-md-6 col-xs-12">
                    {% endif %}
                    {% if gh.status == 'Awaiting Payment' %}
                        <div class="panel panel-white post panel-shadow">
                            <div class="post-heading">
                                <div class="meta">
                                    <div class="title h5">
                                        <a href="javascript:;"><b>{{ request.user.member.first_name }}, </b> <i>{{ gh.sender.first_name }}</i>
                                            will Put ‎₦ {{ gh.amount|intcomma }} in Box</a>
                                    </div>
{#                                    <h6 class="text-muted time">Since {{ gh.created|naturaltime }}</h6>#}
                                </div>
                            </div>
                            <div class="post-description">
                                <div class="time-to-pay text-center" data-expires="{{ gh.expires }}" data-type="GH-WP" data-transaction-detail="{{ gh.id }}"></div>
                                <p>ID: {{ gh.id }}</p>
                                <div class="row no-margin">
                                    <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="GH-WP-Yes" data-transaction-detail="{{ gh.id }}">
                                        Show Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% elif gh.status == 'Awaiting Confirmation' %}
                        <div class="panel panel-white post panel-shadow">
                            <div class="post-heading">
                                <div class="meta">
                                    <div class="title h5">
                                        <a href="javascript:;">{{ request.user.member.first_name }}, ‎₦ {{ gh.amount|intcomma }} was put in your Box
                                            by {{ gh.sender.first_name }}, please confirm</a>
                                    </div>
{#                                    <h6 class="text-muted time">Since {{ gh.proof_date|naturaltime }}</h6>#}
                                </div>
                            </div>
                            <div class="post-description">
                                <div class="time-to-pay text-center" data-expires="{{ gh.proof_date }}" data-type="GH-WC" data-transaction-detail="{{ gh.id }}"></div>
                                <p>ID: {{ gh.id }}</p>
                                <div class="row no-margin">
                                    <a href="javascript:;" class="btn btn-warning stat-item refuse-to-pay" data-type="GH-WC-No" data-transaction-detail="{{ gh.id }}">
                                         No! Not Received
                                    </a>
                                    <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="GH-WC-Yes" data-transaction-detail="{{ gh.id }}">
                                         Yes! Received
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% elif gh.status == 'Exception' %}
                        <div class="panel panel-white post panel-shadow">
                            <div class="post-heading">
                                <div class="meta">
                                    <div class="title h5">
                                        <a href="javascript:;">{{ request.user.member.first_name }}, you complained about this payment
                                            ‎₦ {{ gh.amount|intcomma }} </a>
                                    </div>
                                </div>
                            </div>
                            <div class="post-description">
                                <div class="time-to-pay_ text-center text-warning" data-expires="{{ gh.expires }}" data-type="GH-EX" data-transaction-detail="{{ gh.id }}">Please report to Admin with {{ gh.id }}</div>
                                <p>Order: {{ gh.id }}</p>
                                <div class="row no-margin">
                                    <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="GH-EX-Yes" data-transaction-detail="{{ gh.id }}">
                                        I have seen the Money
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% elif gh.status == 'Cancelled' %}
                        <div class="panel panel-white post panel-shadow">
                            <div class="post-heading">
                                <div class="pull-left image">
                                    <i class="fa fa-ban text-danger"></i>
                                </div>
                                <div class="meta">
                                    <div class="title h5">
                                        <a href="javascript:;"><b>Dear {{ request.user.member.first_name }} {{ request.user.member.surname }}, </b> <i>{{ gh.sender.first_name }} {{ gh.sender.surname }}</i>
                                            has been matched to pay you ‎₦ {{ gh.amount|intcomma }}</a>
                                    </div>
                                    <h6 class="text-muted time">Since {{ gh.created|naturaltime }}</h6>
                                </div>
                            </div>
                            <div class="post-description">
                                <div>Since {{ gh.proof_date|naturaltime }}</div>
                                <p>Order: {{ gh.id }}</p>
                                <div class="row no-margin">
                                    <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="GH-CX-Yes" data-transaction-detail="{{ gh.id }}">
                                        Show Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% elif gh.status == 'Confirmed' %}
                        <div class="panel panel-white post panel-shadow">
                            <div class="post-heading">
                                <div class="pull-left image">
                                    <i class="fa fa-ban text-danger"></i>
                                </div>
                                <div class="meta">
                                    <div class="title h5">
                                        <a href="javascript:;"><b>Dear {{ request.user.member.first_name }} {{ request.user.member.surname }}, </b> <i>{{ gh.sender.first_name }} {{ gh.sender.surname }}</i>
                                            has been matched to pay you ‎₦ {{ gh.amount|intcomma }}</a>
                                    </div>
                                    <h6 class="text-muted time">Since {{ gh.created|naturaltime }}</h6>
                                </div>
                            </div>
                            <div class="post-description">
                                <div>Since {{ gh.proof_date|naturaltime }}</div>
                                <p>Order: {{ gh.id }}</p>
                                <div class="row no-margin">
                                    <a href="javascript:;" class="btn btn-success stat-item agree-to-pay" data-type="GH-CO-Yes" data-transaction-detail="{{ gh.id }}">
                                        show Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    </div>
                {% endfor %}

            </div>
            <div class="clearfix"> </div>
        </div>
    </div>
    <div class="copy-section"><p>© 2017 HelpBox. All rights reserved </p></div>


    <script src="{% static 'bootstrap-notify/bootstrap-notify.min.js' %}"></script>
    <script src="{% static 'bootbox/bootbox.js' %}"></script>
    <script src="{% static 'jquery.countdown/jquery.countdown.min.js' %}"></script>



    <script type="text/javascript">
        $(document).ready(function () {
            var packages = [];
            var getClass = function (m, timmeout) {
                var rate = m / (timmeout * 60) * 100;
                if (rate > 66.66) {
                    return "text-primary";
                } else if (rate > 33.33) {
                    return "text-warning";
                } else {
                    return "text-danger";
                }
            };

            $.each($("div.time-to-pay"), function (i, v) {
                var endDate = $(v).data('expires');
                var type = $(this).data('type');
                var phTimeoutHours = parseInt('{{ phTimeoutHours }}');
                if (type == 'GH-WC' || type == 'PH-WC') {
                    endDate = new Date(endDate).addHours(parseInt('{{ popConfirmTimeout }}'));
                    phTimeoutHours = parseInt('{{ popConfirmTimeout }}');
                }
                console.log(endDate)
                $(v).countdown(endDate)
                    .on('update.countdown', function (event) {
                        {#                            console.log(event.offset.totalMinutes)#}
                        $(this).text(event.strftime('%I Hours: %M Minutes: %S Seconds')).removeClass('text-warning text-primary text-danger').addClass(getClass(event.offset.totalMinutes, phTimeoutHours));
                    })
                    .on('finish.countdown', function (event) {
                        var urll = "";

                        switch ($(this).data('type')) {
                            case ('PH-WP'): {
                                $(this).html("<small>Sorry, your time has elapsed & this account will be deleted within the next 72hrs <br>To unblock your account, please write to support@paymaster.club</small>");
                                urll = "{% url 'core:account-block' 'TD0000000000000000' %}";
                                break;
                            }
                            case ('PH-WC'):
                            case('GH-WC'): {
                                $(this).html("<small>System will auto confirm this payment for you</small>");
                                urll = "{% url 'core:auto-confirm-payment' 'TD0000000000000000' 'True' %}";
                                break;
                            }
                            case('GH-WP'): {
                                $(this).html("<small>Sorry, this user will be blocked. Do not panic, the system will rematch you with another participant</small>");
                                urll = "{% url 'core:account-block' 'TD0000000000000000' %}";
                                return;
                            }
                        }

                        processFeed(urll.replace("TD0000000000000000", $(this).data('transaction-detail')), {id: $(this).data('transaction-detail')}, "Please Wait...", false, 'POST', function (d) {
                            bootbox.alert("<b>" + d.msg + "</b>");
                        }, function (d) {
                            bootbox.alert(d.responseText)
                        });
                    });
                });

                $("a.refuse-to-pay").click(function () {
                    console.log($(this).data('type'));
                    tdid = $(this).data('transaction-detail');
                    switch ($(this).data('type')) {
                        {#                    case ('GH-WP-No'): {#}
                        {#                        //TODO: Delete#}
                        {#                        bootbox.prompt("Please Confirm from Bank Statement First!!! <div style='font-size: .6em;font-weight: normal;font-style: italic;'>If you have confirmed this user did not pay you. Please make a note for the admin. You will be rematched once your claim is asserted true!</div>", function (result) {#}
                        {#                            if (result != null) {#}
                        {#                                processFeed("{% url 'core:payment-exception' 'TD0000000000000000' %}".replace("TD0000000000000000", tdid), {#}
                        {#                                    id: tdid,#}
                        {#                                    note: result#}
                        {#                                }, "Please Wait...", false, 'POST', function (d) {#}
                        {#                                    bootbox.alert("<b>" + d.msg + "</b>", function (d) {#}
                        {#                                        location.href = ".";#}
                        {#                                    });#}
                        {#                                }, function (d) {#}
                        {#                                    bootbox.alert(d.responseText)#}
                        {#                                });#}
                        {#                            }#}
                        {#                        });#}
                        {#                        bootbox.prompt("Why do you reject to Pay? <div style='font-size: .6em;font-weight: normal;font-style: italic;'>Be assured we will assist you if need be, you can contact our Support Team via our FaceBook page or support@paymaster.club if you have any concern</div>", function (result) {#}
                        {#                            if (result != null) {#}
                        {#                                console.log("......")#}
                        {#                            }#}
                        {#                        });#}
                        {#                        break;#}
                        {#                    }#}
                        case ('PH-WP-No'): {
                            bootbox.prompt("Please can you tell us you don't want to Pay? ", function (result) {
                                if (result != null) {
                                    processFeed("{% url 'core:account-block' 'TD0000000000000000' %}".replace("TD0000000000000000", tdid), {
                                        tdid: tdid,
                                        reason: result
                                    }, "Please Wait...", false, 'POST', function (d) {
                                        bootbox.alert("<b>" + d.msg + "</b>", function (d) {
                                            location.href = ".";
                                        });
                                    }, function (d) {
                                        bootbox.alert(d.responseText)
                                    });
                                }
                            });
                            break
                        }
                        case ('GH-WC-No'): {
                            bootbox.prompt("Please tell why u'r not confirming this !!! ", function (result) {
                                if (result != null) {
                                    processFeed("{% url 'core:payment-exception' 'TD0000000000000000' %}".replace("TD0000000000000000", tdid), {
                                        tdid: tdid,
                                        note: result
                                    }, "Please Wait...", false, 'POST', function (d) {
                                        bootbox.alert("<b>" + d.msg + "</b>", function (d) {
                                            location.href = ".";
                                        });
                                    }, function (d) {
                                        bootbox.alert(d.responseText)
                                    });
                                }
                            });
                            break;
                        }
                    }
                });

                $("a.agree-to-pay").click(function () {
                    var tdid = $(this).data('transaction-detail');
                    switch ($(this).data('type')) {
                        case ('PH-WC-Yes'):
                        case ('PH-EX-Yes'):
                        case ('PH-CX-Yes'):
                        case ('PH-CO-Yes'):
                        case ('GH-WP-Yes'):
                        case ('GH-WC-Yes'):
                        case ('GH-EX-Yes'):
                        case ('GH-CX-Yes'):
                        case ('GH-CO-Yes'): {
                            var dialog = bootbox.dialog({title: 'Payment Details ', size: 'large', message: '<p><i class="fa fa-spin fa-spinner"></i> Loading...</p>'});
                            {#                        dialog.init(function () {#}
                            {#                            dialog.find(".bootbox-body").html($(".bootbox-body").load("{% url 'core:receiver-details' 'TD0000000000000000' %}".replace('TD0000000000000000', tdid)));#}
                            {#                        }, function (result) {#}
                            {#                            console.log(result);#}
                            {#                        });#}
                            break;
                        }
                        case ('PH-WP-Yes'): {
                            var dialog = bootbox.dialog({title: 'Beneficiary Details ', size: 'large', message: '<p><i class="fa fa-spin fa-spinner"></i> Loading...</p>'});
                            break
                        }
                    }

                    dialog.init(function () {
                        dialog.find(".bootbox-body").load("{% url 'core:receiver-details' 'TD0000000000000000' %}".replace('TD0000000000000000', tdid));
                        {#                    dialog.find(".bootbox-body").html($(".bootbox-body").load("{% url 'core:receiver-details' 'TD0000000000000000' %}".replace('TD0000000000000000', tdid)));#}
                    }, function (result) {
                        console.log(result);
                    });
                });

                $("#ph-btn").click(function () {
                    ph([]);
    {#                if (packages.length === 0) {#}
    {#                    processFeed(url, data, blocking, method, successCallback, errorCallback) {#}
    {#                    processFeed("{% url 'core:api-package-list' %}", {}, null, false, false, 'GET', function (d) {#}
    {#                        $.each(d, function (i, v) {#}
    {#                            packages.push({text: v.name + ' (₦ ' + v.amount + ')', value: v.amount})#}
    {#                        });#}
    {#                        ph(packages);#}
    {#                    }, function (d) {#}
    {##}
    {#                    });#}
    {#                }else {#}
    {#                    ph(packages);#}
    {#                }#}
                });

                function ph(paks) {
                    bootbox.prompt({
                        title: "<center><i class='glyphicon glyphicon-briefcase' aria-hidden='true'></i> Put Help (PH)</center><hr>You can Put Help between Min: <b>₦"+formatMoney(parseInt({{ request.user.member.min_ph }}))+"</b>, Max: <b>₦"+ formatMoney(parseInt({{ request.user.member.max_ph }}))+ "</b><br /><i>Please PH only in the multiple of ₦{{ ph_multiple }}</i></small></br>",
                        inputType: 'number',
                        callback: function (amount) {
                            console.log(amount)
                            if (amount !== null) {
                                if(amount < parseInt('{{ request.user.member.min_ph }}')){
                                    $.notify({icon: "fa fa-exclamation-triangle", title: "", message: "Your PH cannot be less than ₦"+formatMoney(parseInt({{ request.user.member.min_ph }}))}, {type: 'danger', z_index: 9999999});
                                    return
                                }
                                if(amount > parseInt('{{ request.user.member.max_ph }}')){
                                    if(amount > parseInt('{{ max_ph }}')){
                                        $.notify({icon: "fa fa-exclamation-triangle", title: "", message: "Your PH cannot be more than ₦"+formatMoney(parseInt({{ max_ph }}))}, {type: 'danger', z_index: 9999999});
                                    }else {
                                        $.notify({icon: "fa fa-exclamation-triangle", title: "", message: "Your PH cannot be more than ₦"+formatMoney(parseInt({{ request.user.member.max_ph }}))+" at the moment. This limit will be lifted after you have recyled"}, {type: 'danger', z_index: 9999999});
                                    }
                                    return
                                }
                                if((amount%parseInt('{{ ph_multiple }}')) > 0){
                                    $.notify({icon: "fa fa-exclamation-triangle", title: "", message: "Your PH 'MUST' be in multiple ₦"+formatMoney(parseInt({{ ph_multiple }}))+" ONLY"}, {type: 'danger', z_index: 9999999});
                                    return
                                }
                                bootbox.confirm({
                                    title: "Confirm PH",
                                    message: "Are you sure you want to Put <b>₦ " + formatMoney(parseInt(amount)) + " </b> Help in the  Box?",
                                    buttons: {
                                        cancel: {label: '<i class="fa fa-times"></i> Cancel'},
                                        confirm: {label: '<i class="fa fa-check"> </i> Yes, Put Help!'}
{#                                        confirm: {label: '<i class="fa fa-check"> </i> Yes, Go ahead!'}#}
                                    },
                                    callback: function (result) {
                                        if (result) {
                                            processFeed("{% url 'core:ph' '000000' %}".replace("000000", amount), {}, "Processing...", false, 'POST', function (d) {
                                                if (d.type == 'Info') {
                                                    bootbox.alert("<b>" + d.msg + "</b>")
                                                } else if (d.type == 'Refresh') {
                                                    bootbox.alert("<b>" + d.msg + "</b>", function (d) {
                                                        console.log(d);
                                                        location.href = "{% url 'core:dashboard' %}";
                                                    });
                                                }
                                            }, function (d) {
                                                $.notify({icon: "fa fa-exclamation-triangle", title: "", message: d.responseText}, {type: 'danger', z_index: 9999999});
                                            });
                                        }
                                    }
                                });
                            }
                        }
                    });
                }


                $("#verify-phone-link").click(function(d){loadPhoneModal();});

                $("body").on("click", "#resend-code-link", function(d){
                    processFeed("{% url 'core:resend-code' %}", {}, "Processing...", false, 'POST', function (d) {
                        if (d.type == 'Info') {
                            bootbox.alert("<b>" + d.msg + "</b>")
                        } else if (d.type == 'Success') {
                            bootbox.alert("<b>" + d.msg + "</b>", function (d) {
                                console.log(d);
                                location.href = "{% url 'core:dashboard' %}";
                            });
                        }
                    }, function (d) {
                        $.notify({icon: "fa fa-exclamation-triangle", title: "", message: d.responseText}, {type: 'danger', z_index: 9999999});
                    });
                });
                $("body").on("click", "#verify-code-btn", function(d){
                    var code = $("#phone-code").val();
                    if (code.length < 6){return;}
                    processFeed("{% url 'core:verify-phone-code' %}", {code: code}, "Processing...", false, 'POST', function (d) {
                        if (d.type == 'Info') {
                            bootbox.alert("<b>" + d.msg + "</b>")
                        } else if (d.type == 'Success') {
                            bootbox.alert("<b>" + d.msg + "</b>", function (d) {
                                console.log(d);
                                location.href = "{% url 'core:dashboard' %}";
                            });
                        }
                    }, function (d) {
                        $.notify({icon: "fa fa-exclamation-triangle", title: "", message: d.responseText}, {type: 'danger', z_index: 9999999});
                    });
                });

                function loadPhoneModal(dialog){
                    var phoneDialog = bootbox.dialog({
                        title: 'Phone Verification',
                        message: '<p><i class="fa fa-spin fa-spinner"></i><img src="{% static 'front/images/box.png' %}" /> Loading...</p>'
                    });
                    phoneDialog.init(function(){
                        setTimeout(function(){
                            phoneDialog.find('.bootbox-body').html('<div class="row"><div class="col-md-6 col-sm-12"><div class="input-group"><input type="text" id="phone-code" class="form-control" ><div class="input-group-btn"><button type="button" id="verify-code-btn" class="btn btn-warning dropdown-toggle" >Verify</button></div></div></div> <div class="col-md-6 col-sm-12"> Code Not Received <a href="javascript:;" id="resend-code-link" class="btn btn-warning" >Resend</a></div></div>');
                        }, 500);
                    });
                }

                $("#verify-email-link").click(function(d){loadEmailModal();});

                $("body").on("click", "#resend-email-link", function(d){
                  console.log("-------")
                    processFeed("{% url 'core:resend-email' %}", {}, "Processing...", false, 'POST', function (d) {
                        if (d.type == 'Info') {
                            bootbox.alert("<b>" + d.msg + "</b>")
                        } else if (d.type == 'Success') {
                            bootbox.alert("<b>" + d.msg + "</b>", function (d) {
                                console.log(d);
                                location.href = "{% url 'core:dashboard' %}";
                            });
                        }
                    }, function (d) {
                        $.notify({icon: "fa fa-exclamation-triangle", title: "", message: d.responseText}, {type: 'danger', z_index: 9999999});
                    });
                });

                function loadEmailModal(dialog){
                    var dialog = bootbox.dialog({
                        title: 'Email Verification',
                        message: '<p><i class="fa fa-spin fa-spinner"></i><img src="{% static 'front/images/box.png' %}" /> Loading...</p>'
                    });
                    dialog.init(function(){
                        setTimeout(function(){
                            dialog.find('.bootbox-body').html('<p> Email Not Received <a href="javascript:;" id="resend-email-link" class="btn btn-warning" >Resend</a></p>');
                        }, 500);
                    });
                }

                function formatMoney(num, decimalPlace, currency) {
                    if (typeof decimalPlace === 'undefined') {
                        decimalPlace = 0;
                        var p = num.toFixed(2).split(".");
                    } else {
                        var p = [num + ""]
                    }
                    if (typeof currency === 'undefined') {
                        currency = '';
                    }

                    return currency + p[0].split("").reverse().reduce(function (acc, num, i, orig) {
                            return num == "-" ? acc : num + (i && !(i % 3) ? "," : "") + acc;
                        }, "") + ((decimalPlace == 0) ? "" : "." + p[1]);
                }

            });
            dd = ""

    </script>
{% endblock %}